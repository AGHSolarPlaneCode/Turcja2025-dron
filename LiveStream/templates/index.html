<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Shape Detection Stream</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #1a1a1a;
            color: white;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: #4CAF50;
        }
        .video-container {
            text-align: center;
            margin: 20px 0;
        }
        .video-stream {
            max-width: 100%;
            height: auto;
            border: 3px solid #4CAF50;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.3);
        }
        .info-panel {
            background-color: #2d2d2d;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 1px solid #444;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            background-color: #333;
        }
        .status.connected {
            background-color: #4CAF50;
            color: white;
        }
        .status.disconnected {
            background-color: #f44336;
            color: white;
        }
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        .btn {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        .btn:hover {
            background-color: #45a049;
        }
        .shape-legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .legend-item {
            background-color: #333;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #4CAF50;
        }
        .legend-item h4 {
            margin: 0 0 10px 0;
        }
        .red-shape { border-left-color: #f44336; }
        .blue-shape { border-left-color: #2196F3; }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            .video-stream {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Live Shape Detection Stream</h1>
        
        <div class="video-container">
            <img src="{{ url_for('video_feed') }}" class="video-stream" alt="Live Video Stream">
        </div>
        
        <div class="info-panel">
            <h3>üìä Stream Information</h3>
            <div id="status" class="status disconnected">
                Status: Connecting...
            </div>
            <p><strong>Resolution:</strong> 1280x720</p>
            <p><strong>Detection Mode:</strong> Shapes (Triangle, Square, Hexagon)</p>
            <p><strong>Colors:</strong> Red and Blue</p>
            <p><strong>Required Detections:</strong> 6 frames in a row</p>
        </div>
        
        <div class="controls">
            <button class="btn" onclick="refreshStream()">üîÑ Refresh Stream</button>
            <button class="btn" onclick="toggleFullscreen()">üì∫ Toggle Fullscreen</button>
        </div>
        
        <div class="info-panel">
            <h3>üéØ Detection Legend</h3>
            <div class="shape-legend">
                <div class="legend-item red-shape">
                    <h4>üî∫ Red Triangle</h4>
                    <p>Area threshold: ~260px</p>
                </div>
                <div class="legend-item red-shape">
                    <h4>üü• Red Square</h4>
                    <p>Area threshold: ~2300px</p>
                </div>
                <div class="legend-item blue-shape">
                    <h4>üü¶ Blue Square</h4>
                    <p>Area threshold: ~9000px</p>
                </div>
                <div class="legend-item blue-shape">
                    <h4>üî∑ Blue Hexagon</h4>
                    <p>Area threshold: ~6000px</p>
                </div>
            </div>
        </div>
        
        <div class="info-panel">
            <h3>‚ÑπÔ∏è Instructions</h3>
            <ul>
                <li>The system detects colored shapes in real-time</li>
                <li>Shapes must be detected for 6 consecutive frames to trigger saving</li>
                <li>Detected shapes are outlined with colored contours</li>
                <li>Center points are marked with green circles</li>
                <li>Images are automatically saved when detection threshold is met</li>
            </ul>
        </div>
    </div>

    <!-- Socket.IO for real-time communication -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script>
        // Initialize Socket.IO connection
        var socket = io();
        
        socket.on('connect', function() {
            document.getElementById('status').textContent = 'Status: Connected';
            document.getElementById('status').className = 'status connected';
        });
        
        socket.on('disconnect', function() {
            document.getElementById('status').textContent = 'Status: Disconnected';
            document.getElementById('status').className = 'status disconnected';
        });
        
        socket.on('status', function(data) {
            console.log('Server status:', data.msg);
        });
        
        // Utility functions
        function refreshStream() {
            var img = document.querySelector('.video-stream');
            var src = img.src;
            img.src = '';
            img.src = src + '?t=' + new Date().getTime();
        }
        
        function toggleFullscreen() {
            var img = document.querySelector('.video-stream');
            if (!document.fullscreenElement) {
                img.requestFullscreen().catch(err => {
                    alert('Error attempting to enable fullscreen: ' + err.message);
                });
            } else {
                document.exitFullscreen();
            }
        }
        
        // Auto-refresh stream every 30 seconds to prevent freezing
        setInterval(function() {
            var img = document.querySelector('.video-stream');
            var tempSrc = img.src;
            img.src = '';
            setTimeout(function() {
                img.src = tempSrc;
            }, 100);
        }, 30000);
        
        // Display current time
        function updateTime() {
            var now = new Date();
            var timeString = now.toLocaleString();
            document.title = 'Live Detection - ' + timeString;
        }
        
        setInterval(updateTime, 1000);
        updateTime();
    </script>
</body>
</html>